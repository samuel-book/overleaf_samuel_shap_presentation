%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Set up document

\documentclass{beamer}
\usecolortheme{whale}
\setbeamersize{text margin left=5mm,text margin right=5mm}

% Used to create a section slide between section
\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

% Remove default navigation symbols and add just  page number
\setbeamertemplate{navigation symbols}{} % Clear default navigation
\addtobeamertemplate{navigation symbols}{}{%
    \usebeamerfont{footline}%
    \usebeamercolor[fg]{footline}%
    \hspace{1em}%
    \insertframenumber/\inserttotalframenumber
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Title page

\title{What would other emergency stroke teams do?}
\subtitle{Using explainable machine learning to understand variation in thrombolysis practice}


\author{Kerry Pearn\inst{1}, Michael Allen\inst{1,3}, Anna Laws\inst{1}, Richard Everson\inst{3}, Martin James\inst{1,2} }
\institute{\inst{1}University of Exeter Medical School \inst{2}Royal Devon University Healthcare NHS Foundation Trust \inst{3}University of Exeter Institute of Data Science and Artificial Intelligence}

%\institute{Overleaf}
%\date{March 2023}


\begin{document}

%\frame{\titlepage}

\begin{frame}
\titlepage

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\include{slides/001_thrombolysis_variation}
\include{slides/003_pathway}
\include{slides/005_approach}
\include{slides/010_ml_overview}
\include{slides/015_model_accuracy_simplification}
\include{slides/018_simplified_features}
\include{slides/020_shap_waterfall}
\include{slides/025_shap_violins_1}
\include{slides/030_shap_violins_2}
\include{slides/035_shap_violins_3}
\include{slides/040_shap_violins_hospitals}
\include{slides/045_shap_summary}
\include{slides/050_shap_regression}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Hospital SHAP predicts a hospital's predisposition to use thrombolysis}

\footnotesize Here we show the relationship of hospital SHAP with the hospital thrombolysis use for 1) the hospitals own patients, and 2) a common 10k cohort of patients.

\begin{center}
\includegraphics[width=1.0\textwidth]{./images/99_twin_correlation_scatter.jpg}
\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{How general effects may be modified by individual hospitals}

\begin{center}
\includegraphics[width=0.88\textwidth]{./images/12aa_two_way_shap_adjustment.jpg}
\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Thrombolysis in subgroups of patients (predicted use in a common 10k cohort at each team)}

\footnotesize The range of the predicted thrombolysis use across the 132 hospitals for subsets of the 10k patient cohort. The subsets of patients to the right of \emph{Ideal patients} all have the ideal patient characteristics with the specified changes

\begin{center}
\includegraphics[width=0.83\textwidth]{./images/15c_modelled_subgroup_violin.jpg}
\end{center}

\scriptsize An \emph{ideal patient} has: Stroke severity NIHSS in range 10-25, Arrival-to-scan time \textless{} 20 minutes, Stroke type = infarction, Precise onset time = True, Prior disability level (mRS) = 0, No use of AF anticoagulants, Onset-to-arrival time \textless{} 90 minutes, Age \textless{80 years}, Onset during sleep = False
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Thrombolysis in subgroups of patients (observed use in each hospitals own patients)}

\footnotesize The range of the observed thrombolysis use across the 132 hospitals for subsets of the hospitals own patients. The subsets of patients to the right of \emph{Ideal patients} all have the ideal patient characteristics with the specified changes.

\begin{center}
\includegraphics[width=0.83\textwidth]{./images/15b_actual_subgroup_violin.jpg}
\end{center}


\scriptsize An \emph{ideal patient} has: Stroke severity NIHSS in range 10-25, Arrival-to-scan time \textless{} 20 minutes, Stroke type = infarction, Precise onset time = True, Prior disability level (mRS) = 0, No use of AF anticoagulants, Onset-to-arrival time \textless{} 90 minutes, Age \textless{80 years}, Onset during sleep = False
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Thrombolysis in subgroups of patients (predicted use in a common 10k cohort at each hospital)}

    \begin{center}
    \includegraphics[width=0.90\textwidth]{./images/15_10k_subgroup.jpg}
    \end{center}

\footnotesize Hospitals with lower thrombolysis use were particularly less likely to give thrombolysis to patients with milder strokes, prior disability, or patients with imprecise onset time.
\newline
\newline
\footnotesize Note: Subgroups, other than \emph{ideal patients}, tend to track each other.  

\end{frame}



\begin{frame}
\frametitle{Thrombolysis in subgroups of patients (observed use in each hospitals own patients)}

    \begin{center}
    \includegraphics[width=0.9\textwidth]{./images/15a_actual_subgroup.jpg}
    \end{center}

\footnotesize Note: Subgroups, other than \emph{ideal patients}, tend to track each other, but with more noise than predicted thrombolysis use. 

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{frame}
\frametitle{Investigating how hospitals differ in thrombolysis decision-making: Artifical patients}

\vspace{3mm}

\begin{columns}[t]
    \begin{column}{0.45\textwidth}
        Base patient:
        \begin{itemize}
            \footnotesize
            \item Onset to arrival = 80 mins
            \item Arrival to scan = 20 mins
            \item Infarction = Yes
            \item NIHSS = 15
            \item Prior disability level = 0
            \item Precise onset time = Yes
            \item Use of AF anticoagulents = No
        \end{itemize}
    \end{column}
    
    \begin{column}{0.5\textwidth}
    Proportion of hospitals predicted to give thrombolysis:
    \footnotesize
    \begin{itemize}
        \item Base patient: 99\%
    \end{itemize}
    Base patient with:
    \begin{itemize}
        \item NIHSS = 4: 73\%
        \item Pre-stroke mRS = 3: 86\%
        \item Estimated stroke onset time: 64\%
    \end{itemize}
    \end{column}

\end{columns}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{How would different teams respond to the same patient?}

    \begin{center}
    \includegraphics[width=0.7\textwidth]{./images/21_shap_waterfall_with_violin_contentious.jpg}
    \end{center}

\footnotesize The patient starts with the same base probability, then each hospital reacts differently when presented with each of the patients characteristics and nudges the probability to a different level.

\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Summary}
\small

\begin{itemize}
    \item The XGBoost/SHAP model revealed that the odds of receiving thrombolysis:

    \begin{itemize}
        \item Reduced with increasing arrival-to-scan time.
        \item Varied 30 fold depending on stroke severity.
        \item Reduced with imprecisely known onset time.
        \item Fell with increasing pre-stroke disability.
        \item Varied 15 fold between hospitals. 
    \end{itemize}

\item The hospital identification (hospital SHAP value) explained 58\% of the variance in between-hospital thrombolysis use. 

\item Compared with hospitals with higher thrombolysis use, hospitals with lower use were particularly less likely to give thrombolysis to patients with milder strokes, prior disability, or patients with imprecise onset time.
\end{itemize}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{document}




